using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;

using UnityEngine;

[System.Serializable]
public class MalwareWrapper
{
    public int mid;
    public int owner;
    public string type;
    public int stealth;
    public int size;
    public int speed;
    public int intrusion;

    public int currentResources;
    public int requiredResources;
    public int resourceRate;

    public string dateTime;

    public string[] features;

    public MalwareWrapper(Malware malware) {
        mid = malware.GetId();
        owner = malware.GetOwner();
        type = malware.GetMalwareType();
        stealth = malware.GetStealth();
        size = malware.GetSize();
        speed = malware.GetSpeed();
        intrusion = malware.GetIntrusion();
        currentResources = malware.GetWorkResources();
        requiredResources = malware.GetWorkRequirement();
        resourceRate = malware.GetWorkRate();
        dateTime = (malware.GetTime() != null) ? malware.GetTime().ToString() : "N/A";

        features = malware.GetFeatures().Select(f => f.ToString()).ToArray();
    }

    public Malware Unwrap() {
        Malware malware = new Malware(mid);
        malware.SetOwner(owner);
        malware.SetMalwareType(type);
        malware.SetStealth(stealth);
        malware.SetSize(size);
        malware.SetSpeed(speed);
        malware.SetIntrusion(intrusion);
        malware.SetWorkResources(currentResources);
        malware.SetWorkRequirement(requiredResources);
        malware.SetWorkRate(resourceRate);
        malware.SetTime(DateTime.Parse(dateTime));

        HashSet<MalwareFeature> features_ = new HashSet<MalwareFeature>();
        features.ToList()
            .ForEach(f => {
                Enum.TryParse(f, out MalwareFeature f_);
                features_.Add(f_);
            });
        malware.SetFeatures(features_);

        return malware;
    }
}
