using System.Collections;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using UnityEngine;

[System.Serializable]
public class MalwareDAO : IDAO
{
    public MalwareWrapper[] malware;

    public bool Save(ISavable savable) {
        MalwareController manager = (MalwareController) savable;
        malware = manager.GetMalware().Select(m => m.Value.Wrap()).ToArray();

        string json = JsonUtility.ToJson(this, GameManager.READABLE_SAVE);
        File.WriteAllText(Application.persistentDataPath + "/malwaresave.json", json);

        return true;
    }

    public bool Load(ISavable savable) {
        MalwareController manager = (MalwareController) savable;
        if (File.Exists(Application.persistentDataPath + "/malwaresave.json")) {
            string json = File.ReadAllText(Application.persistentDataPath + "/malwaresave.json");
            MalwareDAO temp = JsonUtility.FromJson<MalwareDAO>(json);
            
            Dictionary<int, Malware> malware_ = new Dictionary<int, Malware>();
            foreach(MalwareWrapper wrapper in temp.malware) {
                Malware m = wrapper.Unwrap();
                malware_.Add(m.GetId(), m);
            }
            manager.SetMalware(malware_);

            return true;
        } else return false;
    }

    public bool Erase() {
        if(File.Exists(Application.persistentDataPath + "/malwaresave.json")) {
            File.Delete(Application.persistentDataPath + "/malwaresave.json");
            return true;
        } else return false;
    }
}
